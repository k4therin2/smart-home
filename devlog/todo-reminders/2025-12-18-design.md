# WP-4.1: Todo List & Reminders - Design Document

**Date:** 2025-12-18
**Owner:** Agent-TDD-Worker-2847
**Status:** Design Complete

## Overview

Implement a todo list and reminder system with voice and UI input support, following the existing architecture patterns in the codebase.

## Requirements (from REQ-028)

- Add todos via voice ("add milk to shopping list")
- Multiple lists supported (todos, shopping, etc.)
- Set reminders with deadlines
- Voice/UI notifications for reminders
- Mark items complete
- List viewing via UI

## Architecture

### Data Model (SQLite)

```sql
-- Todo items
CREATE TABLE todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    list_name TEXT NOT NULL DEFAULT 'default',
    content TEXT NOT NULL,
    priority INTEGER DEFAULT 0,          -- 0=normal, 1=high, 2=urgent
    status TEXT DEFAULT 'pending',       -- pending, completed, cancelled
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    due_date TIMESTAMP,                  -- optional deadline
    tags TEXT                            -- JSON array of tags
);

-- Reminders
CREATE TABLE reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    todo_id INTEGER,                     -- optional link to todo item
    message TEXT NOT NULL,
    remind_at TIMESTAMP NOT NULL,
    repeat_interval TEXT,                -- 'daily', 'weekly', 'monthly', NULL for one-time
    status TEXT DEFAULT 'pending',       -- pending, triggered, dismissed
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    triggered_at TIMESTAMP,
    FOREIGN KEY (todo_id) REFERENCES todos(id) ON DELETE SET NULL
);

-- Pre-defined lists
CREATE TABLE todo_lists (
    name TEXT PRIMARY KEY,
    description TEXT,
    icon TEXT,                           -- optional icon identifier
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Module Structure

```
src/
  todo_manager.py      # TodoManager class - CRUD for todos
  reminder_manager.py  # ReminderManager class - reminders with scheduling

tools/
  productivity.py      # Agent tool definitions

tests/
  unit/
    test_todo_manager.py
    test_reminder_manager.py
  integration/
    test_productivity.py
```

### Classes

#### TodoManager (`src/todo_manager.py`)

Handles all todo CRUD operations:
- `add_todo(content, list_name, priority, due_date, tags)` -> todo_id
- `get_todo(todo_id)` -> todo dict
- `get_todos(list_name, status, include_completed)` -> list of todos
- `update_todo(todo_id, **kwargs)` -> success
- `complete_todo(todo_id)` -> success
- `delete_todo(todo_id)` -> success
- `create_list(name, description)` -> success
- `get_lists()` -> list of list names
- `search_todos(query)` -> matching todos

#### ReminderManager (`src/reminder_manager.py`)

Handles reminders with deadline notifications:
- `set_reminder(message, remind_at, todo_id, repeat_interval)` -> reminder_id
- `get_reminder(reminder_id)` -> reminder dict
- `get_pending_reminders()` -> list of pending reminders
- `get_due_reminders()` -> reminders that should trigger now
- `trigger_reminder(reminder_id)` -> notification result
- `dismiss_reminder(reminder_id)` -> success
- `delete_reminder(reminder_id)` -> success

### Agent Tools (5 tools)

1. **add_todo** - Add a new todo item
   - Parameters: content (str), list_name (str, optional), priority (str, optional), due_date (str, optional)
   - Example: "add milk to shopping list" -> list_name='shopping', content='milk'

2. **list_todos** - View todos from a list
   - Parameters: list_name (str, optional), show_completed (bool, optional)
   - Returns formatted list of todos

3. **complete_todo** - Mark a todo as done
   - Parameters: todo_id (int) OR content_match (str)
   - Example: "mark buy milk as done" -> content_match='buy milk'

4. **set_reminder** - Create a reminder
   - Parameters: message (str), remind_at (str), repeat (str, optional)
   - Example: "remind me to take meds at 9pm" -> message='take meds', remind_at='21:00'

5. **list_reminders** - View upcoming reminders
   - Parameters: include_past (bool, optional)
   - Returns formatted list of reminders

### Default Lists

Pre-created lists:
- `default` - General todos
- `shopping` - Shopping list (maps to voice commands like "add X to shopping list")
- `work` - Work-related tasks
- `home` - Home/household tasks

### Notification System

Reminders trigger notifications through:
1. Web UI push notifications (via existing PWA/Service Worker)
2. Voice response (via voice puck when implemented)
3. Optional: Slack webhook for remote notifications

### Voice Command Examples

| Voice Input | Parsed Action |
|-------------|---------------|
| "add milk to shopping list" | add_todo(content='milk', list_name='shopping') |
| "remind me to call mom at 5pm" | set_reminder(message='call mom', remind_at='17:00') |
| "what's on my todo list" | list_todos(list_name='default') |
| "mark eggs as done" | complete_todo(content_match='eggs') |
| "show my shopping list" | list_todos(list_name='shopping') |

## Implementation Plan

1. **Phase 1: Core Data Layer** (TDD)
   - Write tests for TodoManager
   - Implement TodoManager with SQLite persistence
   - Write tests for ReminderManager
   - Implement ReminderManager

2. **Phase 2: Agent Integration**
   - Create productivity.py with tool definitions
   - Integration tests with mock voice commands
   - Register tools in agent.py

3. **Phase 3: UI Integration**
   - Add /api/todos endpoints
   - Add todo list component to web UI
   - Add reminder display in web UI

## Test Strategy

- Unit tests: 30+ tests covering all CRUD operations
- Integration tests: 10+ tests for voice command flow
- Target: 90%+ code coverage for new modules

## Files to Create/Modify

**New Files:**
- `src/todo_manager.py`
- `src/reminder_manager.py`
- `tools/productivity.py`
- `tests/unit/test_todo_manager.py`
- `tests/unit/test_reminder_manager.py`
- `tests/integration/test_productivity.py`

**Modified Files:**
- `src/database.py` - Add todo/reminder tables
- `tools/__init__.py` - Export productivity tools
- `agent.py` - Register productivity tools
- `src/server.py` - Add /api/todos endpoints
- `templates/index.html` - Add todo UI section
- `static/app.js` - Add todo interactions
